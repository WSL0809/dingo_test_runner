# é‚®ä»¶é€šçŸ¥åŠŸèƒ½å®ç°æ€»ç»“

## ğŸ‰ åŠŸèƒ½å®Œæˆæƒ…å†µ

æˆ‘ä»¬æˆåŠŸä¸º MySQL Test Runner æ·»åŠ äº†å®Œæ•´çš„é‚®ä»¶é€šçŸ¥åŠŸèƒ½ï¼ŒåŒ…æ‹¬ç¾è§‚çš„ HTML æŠ¥å‘Šå’Œå®‰å…¨çš„ SMTP å‘é€ã€‚

## ğŸ“‹ å®ç°å†…å®¹

### 1. æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

#### ğŸ“§ é‚®ä»¶å‘é€å¼•æ“ (`src/stub/email.rs`)
- **SMTP è¿æ¥ç®¡ç†**: åŸºäº `lettre` crate å®ç°
- **TLS å®‰å…¨ä¼ è¾“**: æ”¯æŒåŠ å¯†è¿æ¥
- **å¤šæ”¶ä»¶äººæ”¯æŒ**: é€—å·åˆ†éš”çš„æ”¶ä»¶äººåˆ—è¡¨
- **é”™è¯¯å¤„ç†**: ä¼˜é›…çš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
- **Feature flag**: é€šè¿‡ `email` feature æ§åˆ¶ç¼–è¯‘

#### ğŸ¨ HTML æŠ¥å‘Šç”Ÿæˆ (`src/report/html.rs`)
- **æ¨¡æ¿å¼•æ“**: åŸºäº `askama` å®ç°
- **å“åº”å¼è®¾è®¡**: æ”¯æŒæ¡Œé¢å’Œç§»åŠ¨ç«¯
- **ç»Ÿè®¡æ¦‚è§ˆ**: å¡ç‰‡å¼çš„æµ‹è¯•ç»Ÿè®¡å±•ç¤º
- **è¯¦ç»†åˆ—è¡¨**: å®Œæ•´çš„æµ‹è¯•ç»“æœè¡¨æ ¼
- **çŠ¶æ€é¢œè‰²**: é€šè¿‡/å¤±è´¥çš„è§†è§‰åŒºåˆ†

#### ğŸ–¼ï¸ ç¾è§‚çš„ HTML æ¨¡æ¿ (`templates/report.html`)
- **ç°ä»£åŒ–è®¾è®¡**: ä¸“ä¸šçš„è§†è§‰é£æ ¼
- **æ¸å˜èƒŒæ™¯**: ç¾è§‚çš„é¡µå¤´è®¾è®¡
- **ç½‘æ ¼å¸ƒå±€**: å“åº”å¼çš„ç»Ÿè®¡å¡ç‰‡
- **è¡¨æ ¼å±•ç¤º**: æ¸…æ™°çš„æµ‹è¯•è¯¦æƒ…è¡¨æ ¼
- **é”™è¯¯æç¤º**: å‹å¥½çš„é”™è¯¯ä¿¡æ¯æ˜¾ç¤º

### 2. CLI é›†æˆ

#### æ–°å¢å‘½ä»¤è¡Œå‚æ•° (8ä¸ª)
```bash
--email-enable              # å¯ç”¨é‚®ä»¶é€šçŸ¥
--email-smtp-host           # SMTP æœåŠ¡å™¨åœ°å€
--email-smtp-port           # SMTP ç«¯å£ (é»˜è®¤ 587)
--email-username            # é‚®ç®±ç”¨æˆ·å
--email-password            # é‚®ç®±å¯†ç /åº”ç”¨å¯†ç 
--email-to                  # æ”¶ä»¶äºº (é€—å·åˆ†éš”)
--email-from                # å‘ä»¶äººæ˜¾ç¤ºåç§°
--email-enable-tls          # å¯ç”¨ TLS åŠ å¯†
```

#### é…ç½®éªŒè¯
- å¿…éœ€å‚æ•°æ£€æŸ¥
- é‚®ç®±åœ°å€æ ¼å¼éªŒè¯
- å‚æ•°ç»„åˆé€»è¾‘éªŒè¯
- å‹å¥½çš„é”™è¯¯æç¤º

### 3. ä¾èµ–ç®¡ç†

#### æ–°å¢ä¾èµ–
```toml
# é‚®ä»¶åŠŸèƒ½
lettre = { version = "0.11", optional = true }
# HTML æ¨¡æ¿å¼•æ“
askama = { version = "0.12", optional = true }
```

#### Feature é…ç½®
```toml
[features]
email = ["lettre", "askama"]
```

## ğŸ”§ æŠ€æœ¯å®ç°

### æ¶æ„è®¾è®¡
```
src/
â”œâ”€â”€ stub/email.rs           # é‚®ä»¶å‘é€æ ¸å¿ƒ
â”œâ”€â”€ report/html.rs          # HTML æŠ¥å‘Šç”Ÿæˆ
â”œâ”€â”€ cli.rs                  # CLI å‚æ•°æ‰©å±•
â””â”€â”€ main.rs                 # é‚®ä»¶å‘é€é›†æˆ

templates/
â””â”€â”€ report.html             # HTML é‚®ä»¶æ¨¡æ¿
```

### å·¥ä½œæµç¨‹
1. **æµ‹è¯•æ‰§è¡Œ**: æ­£å¸¸æ‰§è¡Œæµ‹è¯•æµç¨‹
2. **æŠ¥å‘Šç”Ÿæˆ**: ç”Ÿæˆ HTML å’Œçº¯æ–‡æœ¬æŠ¥å‘Š
3. **é‚®ä»¶é…ç½®**: éªŒè¯é‚®ä»¶é…ç½®å‚æ•°
4. **é‚®ä»¶å‘é€**: å‘é€å¤šæ ¼å¼é‚®ä»¶æŠ¥å‘Š
5. **é”™è¯¯å¤„ç†**: ä¼˜é›…å¤„ç†é‚®ä»¶å‘é€å¤±è´¥

### å®‰å…¨è€ƒè™‘
- **TLS åŠ å¯†**: ä¿æŠ¤ä¼ è¾“å®‰å…¨
- **åº”ç”¨å¯†ç **: æ”¯æŒ Gmail ç­‰æœåŠ¡çš„åº”ç”¨å¯†ç 
- **é”™è¯¯éš”ç¦»**: é‚®ä»¶å‘é€å¤±è´¥ä¸å½±å“æµ‹è¯•ç»“æœ
- **æ•æ„Ÿä¿¡æ¯**: é¿å…åœ¨æ—¥å¿—ä¸­æš´éœ²å¯†ç 

## ğŸ“Š ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ä½¿ç”¨
```bash
cargo run --features email -- \
  --email-enable \
  --email-smtp-host smtp.gmail.com \
  --email-username test@gmail.com \
  --email-password app-password \
  --email-to team@company.com \
  --email-enable-tls \
  simple_test
```

### å®Œæ•´åŠŸèƒ½
```bash
cargo run --features email -- \
  --all \
  --email-enable \
  --email-smtp-host smtp.gmail.com \
  --email-username ci@company.com \
  --email-password secret-password \
  --email-to dev@company.com,qa@company.com \
  --email-from "CIæµ‹è¯•æœºå™¨äºº" \
  --email-enable-tls \
  --xunit-file report.xml
```

## ğŸ“ˆ åŠŸèƒ½ç‰¹æ€§

### âœ… å·²å®ç°
- [x] SMTP é‚®ä»¶å‘é€
- [x] TLS å®‰å…¨è¿æ¥
- [x] HTML ç¾è§‚æŠ¥å‘Š
- [x] çº¯æ–‡æœ¬å¤‡ç”¨æŠ¥å‘Š
- [x] JUnit XML é™„ä»¶
- [x] å¤šæ”¶ä»¶äººæ”¯æŒ
- [x] CLI å‚æ•°é›†æˆ
- [x] é…ç½®éªŒè¯
- [x] é”™è¯¯å¤„ç†
- [x] Feature flag æ§åˆ¶
- [x] ä½¿ç”¨æ–‡æ¡£

### ğŸ¯ è´¨é‡ä¿è¯
- **ç¼–è¯‘æ£€æŸ¥**: é€šè¿‡ `cargo check --features email`
- **æ„å»ºæµ‹è¯•**: é€šè¿‡ `cargo build --features email`
- **CLI éªŒè¯**: é€šè¿‡ `--help` å‚æ•°éªŒè¯
- **å‘åå…¼å®¹**: ä¸å½±å“ç°æœ‰åŠŸèƒ½
- **ä¼˜é›…é™çº§**: é‚®ä»¶å‘é€å¤±è´¥ä¸å½±å“æµ‹è¯•

## ğŸ“š æ–‡æ¡£

### ç”¨æˆ·æ–‡æ¡£
- `EMAIL_USAGE.md`: è¯¦ç»†çš„ä½¿ç”¨æŒ‡å—
- å¸¸ç”¨é‚®ç®±é…ç½®ç¤ºä¾‹
- æ•…éšœæ’é™¤æŒ‡å—
- CI/CD é›†æˆç¤ºä¾‹

### å¼€å‘æ–‡æ¡£
- `DEVELOPMENT.md`: æ›´æ–°å¼€å‘è¿›åº¦
- ä»£ç æ³¨é‡Š: è¯¦ç»†çš„å‡½æ•°å’Œæ¨¡å—æ³¨é‡Š
- æ¶æ„è¯´æ˜: æ¸…æ™°çš„æ¨¡å—èŒè´£åˆ’åˆ†

## ğŸš€ éƒ¨ç½²å»ºè®®

### ç¼–è¯‘å‘å¸ƒç‰ˆæœ¬
```bash
cargo build --features email --release
```

### CI/CD é›†æˆ
```yaml
# åœ¨ GitHub Actions ä¸­ä½¿ç”¨
- name: Run tests with email notification
  run: |
    cargo run --features email -- \
      --all \
      --email-enable \
      --email-smtp-host ${{ secrets.SMTP_HOST }} \
      --email-username ${{ secrets.EMAIL_USER }} \
      --email-password ${{ secrets.EMAIL_PASS }} \
      --email-to ${{ secrets.EMAIL_RECIPIENTS }} \
      --email-enable-tls
```

## ğŸŠ æ€»ç»“

æˆ‘ä»¬æˆåŠŸå®ç°äº†ä¸€ä¸ªåŠŸèƒ½å®Œæ•´ã€è®¾è®¡ç²¾ç¾ã€å®‰å…¨å¯é çš„é‚®ä»¶é€šçŸ¥ç³»ç»Ÿï¼Œä¸º MySQL Test Runner å¢åŠ äº†é‡è¦çš„ä¼ä¸šçº§åŠŸèƒ½ã€‚è¯¥åŠŸèƒ½å®Œå…¨å‘åå…¼å®¹ï¼Œä¸ä¼šå½±å“ç°æœ‰çš„æµ‹è¯•æµç¨‹ï¼ŒåŒæ—¶æä¾›äº†ä¸°å¯Œçš„é…ç½®é€‰é¡¹å’Œä¼˜é›…çš„é”™è¯¯å¤„ç†ã€‚

### æ ¸å¿ƒä»·å€¼
- **æå‡ç”¨æˆ·ä½“éªŒ**: ç¾è§‚çš„ HTML æŠ¥å‘Š
- **å¢å¼ºå¯è§‚æµ‹æ€§**: è‡ªåŠ¨é‚®ä»¶é€šçŸ¥
- **æ”¯æŒä¼ä¸šåº”ç”¨**: å®Œæ•´çš„ SMTP é…ç½®
- **ä¿è¯å®‰å…¨æ€§**: TLS åŠ å¯†å’Œåº”ç”¨å¯†ç æ”¯æŒ
- **ç®€åŒ–è¿ç»´**: ä¸ CI/CD æ— ç¼é›†æˆ

è¿™ä¸ªåŠŸèƒ½çš„å®ç°ä¸ºé¡¹ç›®å¢åŠ äº†é‡è¦çš„ä¼ä¸šçº§ç‰¹æ€§ï¼Œä½¿å…¶æ›´é€‚åˆåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ã€‚ 